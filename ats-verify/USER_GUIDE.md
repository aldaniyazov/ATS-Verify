# Руководство пользователя системы ATS-Verify

Добро пожаловать в систему ATS-Verify — платформу микросервисов для логистической и таможенной верификации, которая отслеживает посылки, проводит риск-анализ ИИН/БИН, сверяет IMEI коды из PDF-деклараций и предоставляет Kanban-доску для обработки обращений.

Данное руководство содержит инструкции по использованию системы для каждой из ролей.

---

## 1. Роль: Администратор (Admin)

**Функционал:**
Администратор имеет полный доступ ко всем функциям системы и панели управления (Dashboard), включая управление пользователями и риск-анализ.

**Пошаговая инструкция:**
- **Авторизация пользователей:** Пользователи, зарегистрировавшиеся в системе, по умолчанию ожидают вашего подтверждения и выдачи соответствующей роли. Перейдите в раздел управления пользователями, чтобы рассмотреть и одобрить (`Approve`) их заявки.
- **Статистика и отчеты:** На вкладке Dashboard вы можете скачивать CSV-отчеты по датам для анализа эффективности работы системы.
- **Загрузка данных о рисках (Risk CSV):** Загружайте файлы с историческими данными или списки для риск-анализа.
- **Риск-анализ ИИН/БИН:** Администратор может присваивать уровни риска (Красный, Желтый, Зеленый) определенным ИИН или БИН на основе автоматической аналитики (например, частота использования одного и того же ИИН, различные статусы по одному и тому же документу).

---

## 2. Роль: Сотрудник Таможни (Customs)

*Примечание: Доступ выдается Администратором после регистрации пользователя.*

**Функционал:**
Сотрудники таможни обрабатывают заявки на проверку (тикетинг на Kanban-доске), работают с таблицами посылок и проводят верификацию IMEI в PDF-декларациях.

**Пошаговая инструкция:**
- **Kanban-доска (Обращения):**
  1. Перейдите в раздел **Tickets (Обращения)**. Здесь вы увидите заявки, направленные службой ATS.
  2. Заявки (карточки) можно передвигать между колонками статусов (например, из "To Do" в "In Progress", а затем в "Resolved") простым перетаскиванием (drag-and-drop).
  3. Для каждой заявки вы можете оставлять финальные комментарии ("комментарий ГО"), которые будут видны ATS.
- **Работа с посылками:**
  1. В таблице посылок вы можете находить конкретные отправления по трек-номеру.
  2. Для проверенных посылок активируйте флаг `used = true`, чтобы зафиксировать факт таможенного оформления / проверки и избежать повторного использования. Учтите, что после установки данного флага система начнет выдавать ошибку при попытке повторно привязать или загрузить этот номер документа маркетплейсом.
- **Верификация IMEI:**
  1. Перейдите в раздел верификации IMEI.
  2. Вы можете загружать PDF-документы (Таможенные декларации) и CSV-файлы для того, чтобы система автоматически проверила 14-значные IMEI-коды из CSV на наличие соответствий 15-значным номерам в графе 31 PDF-декларации. По результатам будет сгенерирован подробный текстовый отчет.

---

## 3. Роль: Сотрудник ATS (ATS Staff)

*Примечание: Доступ выдается Администратором после регистрации пользователя.*

**Функционал:**
Сотрудники ATS контролируют статус посылок и направляют обращения или апелляции на проверку сотрудникам таможни. 

**Пошаговая инструкция:**
- **Проверка трек-номеров:** Вы можете искать трек-номера в системе, проверять их фактическое существование (через интеграции с Kazpost / CDEK) и видеть статус проверки (установлен ли таможней статус `used = true`).
- **Создание обращений (Тикетов):**
  1. Если возникает спорная ситуация, или по заявке пользователя был получен отказ (апелляция), перейдите в раздел **Tickets / Kanban**.
  2. Создайте новый тикет на проверку (Review ticket) для таможни.
  3. В карточке опишите причину обращения, прикрепите номер заявки и документы. Данная карточка появится у сотрудников таможни в колонке "To Do" для дальнейшей отработки.

---

## 4. Роль: Представитель Маркетплейса (Marketplace)

**Функционал:**
Сотрудники маркетплейсов загружают ежедневные реестры посылок в систему для их дальнейшего отслеживания и оформления.

**Пошаговая инструкция:**
- **Загрузка CSV с реестром посылок:** 
  1. Подготовьте файл в формате CSV со следующими колонками (в строгом соответствии с шаблоном маркетплейса): `marketplace | country | brand | name | track number | SNT | date`.
  2. Перейдите в раздел модуля загрузки файлов (Uploads / Parcels) и загрузите файл в систему.
  3. **Внимание:** Система произведет автоматическую сверку. Если трек-номер уже загружен, но его статус `used = false`, программа выдаст предупреждение, но позволит перезаписать данные. Если трек-номер уже прошел таможенное оформление и помечен как `used = true`, загрузка по этому трек-номеру будет заблокирована с ошибкой (ERROR).
  4. Строки с некорректными или отсутствующими обязательными данными в CSV будут пропущены. Убедитесь, что формат соблюден.

---

## 5. Роль: Платный Пользователь (Paid User / Regular User)

**Функционал:**
Доступен базовый функционал проверки и отслеживания.

**Пошаговая инструкция:**
- **Отслеживание посылок:** Вы можете вводить трек-номера в систему (через виджет отслеживания) для получения информации о статусе отправления в реальном времени. Интеграции охватывают отслеживание отправлений Kazpost и CDEK.
- **Сверка IMEI и PDF:** Если этот функционал включен для вашего аккаунта, вы так же можете загружать документы для сверки IMEI-кодов по аналогии с сотрудниками таможни. Сверка производится на совпадение подстроки в 14 символов внутри графы 31 в PDF-документе.

---

Если у вас возникли дополнительные вопросы или ошибки при работе с системой, пожалуйста, заведите обращение в службу технической поддержки (ATS Support).
